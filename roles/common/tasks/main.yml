---
- name: Update apt cache and upgrade packages
  ansible.builtin.apt:
    update_cache: true
    upgrade: dist

- name: Install baseline administrative tools
  ansible.builtin.apt:
    name:
      - curl
      - git
      - htop
      - auditd
      - fail2ban
    state: present

- name: Enforce SSH security (CIS Benchmark)
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    state: present
  loop:
    - { regexp: '^PermitRootLogin', line: 'PermitRootLogin no' }
    - { regexp: '^PasswordAuthentication', line: 'PasswordAuthentication no' }
  notify: Restart sshd

- name: Ensure Auditd is running for compliance logging
  ansible.builtin.service:
    name: auditd
    state: started
    enabled: true
